{% extends "base.html" %}

{% block content %}
<h2>Fach zum Stundenplan hinzufügen</h2>

{% if error %}
<div style="background-color: rgba(220, 53, 69, 0.1); color: #dc3545; padding: 10px; margin-bottom: 15px; border: 1px solid rgba(220, 53, 69, 0.3); border-radius: 4px;">
  {{ error }}
</div>
{% endif %}

<style>
  .filter-container {
    background: var(--bg-secondary);
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 25px;
    box-shadow: var(--shadow);
    border: 1px solid var(--border-color);
  }
  .filter-row {
    display: flex;
    gap: 15px;
    margin-bottom: 15px;
    flex-wrap: wrap;
  }
  .filter-input {
    padding: 10px 14px;
    border: 1px solid var(--input-border);
    background: var(--input-bg);
    color: var(--text-primary);
    border-radius: 4px;
    font-size: 15px;
  }
  .search-input {
    flex: 1;
    min-width: 200px;
  }
  .fach-item {
    background: var(--bg-secondary);
    padding: 18px;
    margin-bottom: 12px;
    border-radius: 8px;
    box-shadow: var(--shadow);
    border: 1px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .fach-info {
    flex: 1;
  }
  .fach-info strong {
    color: var(--text-primary);
    font-size: 16px;
  }
  .fach-info small {
    color: var(--text-secondary);
    font-size: 13px;
  }
  .no-results {
    text-align: center;
    padding: 30px;
    color: var(--text-secondary);
  }
  .add-btn {
    padding: 10px 18px;
    background: #5cb85c;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;class="reset-btn
    transition: background 0.2s;
  }
  .add-btn:hover {
    background: #4cae4c;
  }
  .reset-btn {
    padding: 10px 16px;
    background: #6c757d;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    transition: background 0.2s;
  }
  .reset-btn:hover {
    background: #5a6268;
  }
</style>

{% if available_faecher %}
<div class="filter-container">
  <div class="filter-row">
    <input 
      type="text" 
      id="searchInput" 
      class="filter-input search-input" 
      placeholder="Suche nach Fach oder Lehrer..."
    >
    
    <select id="tagFilter" class="filter-input">
      <option value="">Alle Wochentage</option>
      <option value="Montag">Montag</option>
      <option value="Dienstag">Dienstag</option>
      <option value="Mittwoch">Mittwoch</option>
      <option value="Donnerstag">Donnerstag</option>
      <option value="Freitag">Freitag</option>
    </select>
    
    <button onclick="resetFilters()" style="padding: 8px 15px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">
      Filter zurücksetzen
    </button>
  </div>
</div>

<div id="fachList">
  {% for fach in available_faecher %}
  <div class="fach-item" 
       data-fachname="{{ fach.fachname|lower }}" 
       data-lehrer="{{ fach.lehrer|lower }}" 
       data-tag="{{ fach.tag }}">
    <div class="fach-info">
      <strong>{{ fach.fachname }}</strong> - {{ fach.lehrer }}<br>
      <small>{{ fach.tag }} {{ fach.startzeit }} - {{ fach.endzeit }} (Raum {{ fach.raum }})</small>
    </div>
    <form method="post" style="display:inline;">
      <input type="hidden" name="fach_id" value="{{ fach.id }}">
      <button type="submit" class="add-btn">
        Hinzufügen
      </button>
    </form>
  </div>
  {% endfor %}
</div>

<div id="noResults" class="no-results" style="display: none;">
  Keine Fächer gefunden, die deinen Filterkriterien entsprechen.
</div>

<script>
  const searchInput = document.getElementById('searchInput');
  const tagFilter = document.getElementById('tagFilter');
  const fachItems = document.querySelectorAll('.fach-item');
  const noResults = document.getElementById('noResults');

  function filterFaecher() {
    const searchTerm = searchInput.value.toLowerCase().trim();
    const selectedTag = tagFilter.value;
    let visibleCount = 0;

    fachItems.forEach(item => {
      const fachname = item.dataset.fachname;
      const lehrer = item.dataset.lehrer;
      const tag = item.dataset.tag;

      const matchesSearch = searchTerm === '' || 
                           fachname.includes(searchTerm) || 
                           lehrer.includes(searchTerm);
      const matchesTag = selectedTag === '' || tag === selectedTag;

      if (matchesSearch && matchesTag) {
        item.style.display = 'flex';
        visibleCount++;
      } else {
        item.style.display = 'none';
      }
    });

    // Show/hide no results message
    if (visibleCount === 0) {
      noResults.style.display = 'block';
    } else {
      noResults.style.display = 'none';
    }
  }

  function resetFilters() {
    searchInput.value = '';
    tagFilter.value = '';
    filterFaecher();
  }

  // Event listeners
  searchInput.addEventListener('input', filterFaecher);
  tagFilter.addEventListener('change', filterFaecher);
</script>

{% else %}
<p>Keine weiteren Fächer verfügbar.</p>
{% endif %}

{% endblock %}