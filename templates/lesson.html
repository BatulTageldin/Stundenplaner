{% extends "base.html" %}

{% block content %}
<h2>Fach hinzufügen</h2>

<form method="post">

  <label>Fach:</label><br>
  <select name="subject" id="subject" required>
    <option value="">Bitte wählen</option>
    <option value="Sport">Sport</option>
    <option value="Physik">Physik</option>
    <option value="Musik">Musik</option>
    <option value="Mathematik">Mathematik</option>
    <option value="Informatik">Informatik</option>
    <option value="Geschichte">Geschichte</option>
    <option value="Geographie">Geographie</option>
    <option value="Englisch">Englisch</option>
    <option value="Deutsch">Deutsch</option>
    <option value="Chemie">Chemie</option>
    <option value="Bildnerisches Gestalten">Bildnerisches Gestalten</option>
  </select><br><br>

  <label>Lehrer:</label><br>
  <select name="teacher" id="teacher" required>
    <option value="">Bitte zuerst Fach wählen</option>
  </select><br><br>

  <label>Raum:</label><br>
  <input type="text" name="room" id="room" readonly><br><br>

  <label>Wochentag:</label><br>
  <select name="weekday" required>
    <option value="1">Montag</option>
    <option value="2">Dienstag</option>
    <option value="3">Mittwoch</option>
    <option value="4">Donnerstag</option>
    <option value="5">Freitag</option>
  </select><br><br>

  <label>Zeitblock:</label><br>
  <select name="timeblock" required>
    <option value="08:45-09:25">08:45 – 09:25</option>
    <option value="09:35-10:20">09:35 – 10:20</option>
    <option value="10:35-11:20">10:35 – 11:20</option>
    <option value="11:30-12:15">11:30 – 12:15</option>
    <option value="13:20-14:05">13:20 – 14:05</option>
    <option value="14:15-15:00">14:15 – 15:00</option>
  </select><br><br>

  <button type="submit">Speichern</button>

</form>

<script>
document.addEventListener("DOMContentLoaded", function() {

  // Daten kommen direkt aus Flask (TEACHER_DATA)
  const daten = {{ teacher_data | tojson }};

  const subjectSelect = document.getElementById("subject");
  const teacherSelect = document.getElementById("teacher");
  const roomInput = document.getElementById("room");

  // Wenn Fach gewählt wird → Lehrer laden
  subjectSelect.addEventListener("change", function() {
    const fach = this.value;
    teacherSelect.innerHTML = "";
    roomInput.value = "";

    // Wenn Fach keine Einträge in daten hat (z.B. Englisch): Hinweis anzeigen
    if (!daten[fach] || daten[fach].length === 0) {
      teacherSelect.innerHTML = '<option value="">Keine Lehrer verfügbar</option>';
      return;
    }

    // Lehreroptionen füllen
    daten[fach].forEach(function(lehrer) {
      const option = document.createElement("option");
      option.value = lehrer.name;
      option.textContent = lehrer.name;
      teacherSelect.appendChild(option);
    });

    // Optional: ersten Lehrer direkt auswählen und Raum setzen
    if (teacherSelect.options.length > 0) {
      teacherSelect.selectedIndex = 0;
      const ersterLehrer = daten[fach][0];
      roomInput.value = ersterLehrer.room || "";
    }
  });

  // Wenn Lehrer gewählt wird → Raum anzeigen
  teacherSelect.addEventListener("change", function() {
    const fach = subjectSelect.value;
    const lehrerName = this.value;

    if (!daten[fach]) {
      roomInput.value = "";
      return;
    }

    const lehrer = daten[fach].find(function(l) {
      return l.name === lehrerName;
    });

    roomInput.value = lehrer ? lehrer.room : "";
  });

});
</script>

{% endblock %}
